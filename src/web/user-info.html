<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>User Info - User Management</title>
  <link rel="stylesheet" href="style.css">
</head>

<body>
  <div class="page-container">
    <div class="card">
      <div id="loadingMessage" class="loading">Loading your information</div>
      <div id="errorMessage" class="error-message hidden"></div>
      <div id="greetingContainer" class="hidden">
        <p class="greeting" id="greetingText"></p>
      </div>
    </div>
  </div>

  <script>
    // User info fetching
    const loadingMessage = document.getElementById('loadingMessage');
    const errorMessage = document.getElementById('errorMessage');
    const greetingContainer = document.getElementById('greetingContainer');
    const greetingText = document.getElementById('greetingText');

    // Get user_id from URL query parameters
    const urlParams = new URLSearchParams(window.location.search);
    const userId = urlParams.get('user_id');

    if (!userId) {
      // No user_id in URL, redirect to login
      window.location.href = 'index.html';
    } else {
      // Fetch user greeting
      fetchUserGreeting(userId);
    }

    async function fetchUserGreeting(userId) {
      try {
        const response = await fetch(`http://localhost:8080/api/users/${userId}`, {
          method: 'GET',
        });

        if (response.ok) {
          const greeting = await response.text();
          loadingMessage.classList.add('hidden');
          greetingText.textContent = greeting || 'Welcome!';
          greetingContainer.classList.remove('hidden');
        } else {
          const errorText = await response.text();
          showError(errorText || 'Failed to load user information.');
        }
      } catch (error) {
        showError('Network error. Please check your connection and try again.');
      }
    }

    function showError(message) {
      loadingMessage.classList.add('hidden');
      errorMessage.textContent = message;
      errorMessage.classList.remove('hidden');

      // Add retry button
      const retryButton = document.createElement('button');
      retryButton.textContent = 'Retry';
      retryButton.className = 'button-secondary';
      retryButton.style.marginTop = '20px';
      retryButton.addEventListener('click', () => {
        errorMessage.classList.add('hidden');
        loadingMessage.classList.remove('hidden');
        if (retryButton.parentNode) {
          retryButton.parentNode.removeChild(retryButton);
        }
        const urlParams = new URLSearchParams(window.location.search);
        const userId = urlParams.get('user_id');
        fetchUserGreeting(userId);
      });

      if (!document.querySelector('.button-secondary')) {
        document.querySelector('.card').appendChild(retryButton);
      }
    }
  </script>
</body>

</html>